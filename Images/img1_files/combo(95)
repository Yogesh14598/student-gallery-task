YUI.add("photo-page-leader-ad-view",function(e,a){require("hermes-core/flog")(a);var i=new e.SubscriptionsHelper;e.namespace("Views")[this.name]=e.Base.create("photo-page-leader-ad-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e},loadState:function(){return e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("photo-page-leader-ad",{adConfig:{adUnit:e.config.flickr.moola.positions.photopage[0].ad_unit_leaderboard,audienceTargets:this.appContext.audienceTargets.getAudienceData(),upgradeProLink:i.getProLandingPageUrl(i.UTM_HIDE_ADS)}})},activate:function(){return this.appContext.adManager.processAdsOnPage(),e.Promise.resolve()}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-leader-ad","subscriptions-helper"],langBundles:["common"]});YUI.add("photo-page-scrappy-view",function(e){var t=require("hermes-core/fletrics");e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var o=this;if(this.backToURL=t.backToURL,this.hideBackToLink=t.hideBackToLink||!1,this.entryTypeIntlKey=t.entryTypeIntlKey,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.nsid=t.nsid,this.geo=t.geo,this.showPhotoPageAd=!0,t.isOwner=this.isOwner,t.fullscreen?this.appContext.experiments.fullscreen.enableFullscreen():this.appContext.experiments.fullscreen.disableFullscreen(),this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext)),this.context&&this.context.params&&this.context.params.isSharedEntity){var i=this.context.params;this.appContext.setGPCredentials({gp_code:i.gpCode,gp_owner:i.gpOwner,share_code:i.gpCode})}else this.appContext.setGPCredentials(null);return this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one&&e.one("head title").set("text",o.intlMessage({intlName:"photo-page-scrappy.PAGE_TITLE",title:t.title.newVal}))})}),YUI.Env.isServer&&this.appContext&&this.appContext.flipper.isFlipped("enable-better-photo-page-seo")&&(this.appContext.forceServerRender=this.appContext._doForcedServerRender()),t.logViewTimings=!0,this},subviewConfig:{"photo-well-scrappy-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,dealbreaker:!0},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"sub-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"moola-sticky-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"photo-page-leader-ad-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-photo-page-ad-bug")}}},additionalViewClasses:function(){var e=[];return this.appContext.getViewer().signedIn||e.push("has-global-nav"),e},getAdditionalSpContexts:function(){return e.Snowplough.getPhotoContextFromModel(this.get("photo"))},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t),e.appContext.adManager.canShowAd(e.get("photo"))||(e.showPhotoPageAd=!1)})},buildContainer:function(){return this.setContainerWithTemplate("photo-page-scrappy",{"global-nav-view":this.subviews["global-nav-view"].get("container"),"photo-well-view":this.subviews["photo-well-scrappy-view"]?this.subviews["photo-well-scrappy-view"].get("container"):"",showNonUSSticky:this.appContext.flipper.isFlipped("enable-sticky-ads")&&"US"!==this.geo.countryCode&&this.showPhotoPageAd&&!this.appContext.getViewer().signedIn}),t.increment("test.photo.page.requests"),this},activate:function(){return this.appContext.adManager.isEnabled()&&this.appContext.adManager.updatePhotoAdsCounter(),this.showPhotoPageAd&&this.appContext.adManager.processAdsOnPage(),this},closeDialog:function(t){e.config.win.location.href=this.backToURL},onSubviewEvent:function(e,t){var o;if(t&&t.length>0)if("make in view"===t[0]&&t.length>1);else if("close in view"===t[0]);else if("getDialogOffset"===t[0])t[1]&&"function"==typeof t[1]&&(o=this.subviews["photo-well-scrappy-view"].get("container"))&&t[1](parseInt(o.getStyle("right").replace("px",""),10)/2);else if("setRedirect"===t[0])this.get("container").all("input[name=redirect_url]").setAttribute("value",window.location.pathname),"function"==typeof t[1]&&t[1]();else{if("rightClickPhoto"===t[0])return!1;"photo:reload"===t[0]?this.reload(["photo-models","photostream-models","photo-exif-models"],this.photoId):"disable-sharing"!==t[0]&&"enable-sharing"!==t[0]||this.fire("parentViewEvent",t[0])}},getTrackingSegments:function(){return{couldHaveSeenAd:!this.get("photo").getValue("owner").getValue("isPro")&&!this.appContext.getViewer().isPro,context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0}},updateDataLayer:function(){var t=this.get("photo"),o=!t.getValue("owner").getValue("isPro")&&!this.appContext.getViewer().isPro,i=o&&0===t.getValue("safetyLevel");e.Analytics.setDataLayerProp("user.profile.segment.couldHaveSeenAd",o),e.Analytics.setDataLayerProp("user.profile.segment.safetyAwareCouldHaveSeenAd",i),e.Analytics.setDataLayerProp("page.pageInfo.safetyLevel",t.getValue("safetyLevel")>=0?e.SafetyHelper.getSafetyLevelString(t.getValue("safetyLevel"),"photo"):"")},destructor:function(){clearTimeout(this.scrollTimeout),this.appContext.adManager.stopInfolinksAdUnit()},buildErrorContainer:function(){this.error&&this.error.is404&&this.appContext.flapp.navigate("/error/notfound")}},{ATTRS:{spaceid:{value:792600543}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-scrappy","signin-helper","overflow-helper","url","safety-level-helper"],optional:["photo-well-scrappy-view","photo-head-meta-view","global-nav-view","sub-photo-view","moola-sticky-view","photo-page-leader-ad-view"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-empty-photo-page",function(e,t){var l=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,l,a,n){var o=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,s=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return s((i(l,"outlet")||t&&i(t,"outlet")||r).call(o,null!=t?i(t,"global-nav-view"):t,{name:"outlet",hash:{},data:n,loc:{start:{line:1,column:0},end:{line:1,column:26}}}))+'\n\n<div class="fluid-centered" style="text-align: center;">\n\t<h3>'+s((i(l,"intlHTMLMessage")||t&&i(t,"intlHTMLMessage")||r).call(o,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.TIMEOUT_FAILURE"},data:n,loc:{start:{line:4,column:5},end:{line:4,column:70}}}))+"</h3>\n</div>\n\n"+s((i(l,"outlet")||t&&i(t,"outlet")||r).call(o,null!=t?i(t,"footer-full-view"):t,{name:"outlet",hash:{},data:n,loc:{start:{line:7,column:0},end:{line:7,column:27}}}))+"\n"},useData:!0}),a={};e.Array.each([],function(t){var l=e.Template.get("hermes/"+t);l&&(a[t]=l)}),e.Template.register("hermes/empty-photo-page",function(t,n){return n=n||{},n.partials=n.partials?e.merge(a,n.partials):a,l(t,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("empty-photo-page-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},additionalViewClasses:function(){var e=[];return this.appContext.getViewer().signedIn||e.push("has-global-nav"),e},buildContainer:function(){return this.setContainerWithTemplate("empty-photo-page"),this}},{ATTRS:{spaceid:{value:792600606}}})},"@VERSION@",{requires:["flickr-view","hermes-template-empty-photo-page","overflow-helper","url"],optional:["global-nav-view"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-photo-page-lightbox",function(e,t){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,a,l,r){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression((n(a,"outlet")||t&&n(t,"outlet")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?n(t,"photo-well-view"):t,{name:"outlet",hash:{},data:r,loc:{start:{line:1,column:0},end:{line:1,column:26}}}))+"\n"},useData:!0}),l={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(l[t]=a)}),e.Template.register("hermes/photo-page-lightbox",function(t,r){return r=r||{},r.partials=r.partials?e.merge(l,r.partials):l,a(t,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-card-engagement",function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,l,a){return" theme-overlay"},3:function(n,e,t,l,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t"+n.escapeExpression((o(t,"outlet")||e&&o(e,"outlet")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},null!=e?o(e,"like-engagement-item-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:5,column:2},end:{line:5,column:38}}}))+"\n"},5:function(n,e,t,l,a){var o,r=null!=e?e:n.nullContext||{},u=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t<span role="button" class="engagement-item fave '+(null!=(o=u(t,"if").call(r,null!=(o=null!=(o=null!=e?u(e,"photoItem"):e)?u(o,"engagement"):o)?u(o,"isFaved"):o,{name:"if",hash:{},fn:n.program(6,a,0),inverse:n.noop,data:a,loc:{start:{line:7,column:50},end:{line:7,column:99}}}))?o:"")+(null!=(o=u(t,"if").call(r,null!=(o=null!=(o=null!=e?u(e,"photoItem"):e)?u(o,"engagement"):o)?u(o,"canFave"):o,{name:"if",hash:{},fn:n.noop,inverse:n.program(8,a,0),data:a,loc:{start:{line:7,column:99},end:{line:7,column:155}}}))?o:"")+'" tabindex="0">\n\t\t\t<span class="engagement-icon">\n\t\t\t\t<i class="animated-fave-star"></i>\n\t\t\t</span>\n\t\t\t<span class="engagement-count'+(null!=(o=u(t,"if").call(r,null!=(o=null!=(o=null!=e?u(e,"photoItem"):e)?u(o,"engagement"):o)?u(o,"faveCount"):o,{name:"if",hash:{},fn:n.noop,inverse:n.program(10,a,0),data:a,loc:{start:{line:11,column:32},end:{line:11,column:83}}}))?o:"")+'">\n\t\t\t\t'+(null!=(o=u(t,"if").call(r,null!=(o=null!=(o=null!=e?u(e,"photoItem"):e)?u(o,"engagement"):o)?u(o,"faveCount"):o,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:12,column:4},end:{line:12,column:96}}}))?o:"")+"\n\t\t\t</span>\n\t\t</span>\n"},6:function(n,e,t,l,a){return" faved"},8:function(n,e,t,l,a){return" can-not-fave"},10:function(n,e,t,l,a){return" empty"},12:function(n,e,t,l,a){var o,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return n.escapeExpression((r(t,"formatNumber")||e&&r(e,"formatNumber")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},null!=(o=null!=(o=null!=e?r(e,"photoItem"):e)?r(o,"engagement"):o)?r(o,"faveCount"):o,{name:"formatNumber",hash:{},data:a,loc:{start:{line:12,column:42},end:{line:12,column:89}}}))},14:function(n,e,t,l,a){var o,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return n.escapeExpression((r(t,"formatNumber")||e&&r(e,"formatNumber")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},null!=(o=null!=(o=null!=e?r(e,"photoItem"):e)?r(o,"engagement"):o)?r(o,"commentCount"):o,{name:"formatNumber",hash:{},data:a,loc:{start:{line:22,column:44},end:{line:22,column:94}}}))},16:function(n,e,t,l,a){return'\t\t<span role="button" class="engagement-item curate" tabindex="0">\n\t\t\t<span class="engagement-icon">\n\t\t\t\t<svg class="icon icon-curate"><use xlink:href="#icon-curate"></use></svg>\n\t\t\t</span>\n\t\t</span>\n'},18:function(n,e,t,l,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t"+n.escapeExpression((o(t,"outlet")||e&&o(e,"outlet")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},null!=e?o(e,"fluid-share-photo-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:33,column:2},end:{line:33,column:35}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(n,e,t,l,a){var o,r=null!=e?e:n.nullContext||{},u=n.hooks.helperMissing,i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<div class="photo-card-engagement\n\t'+(null!=(o=(i(t,"ifCond")||e&&i(e,"ifCond")||u).call(r,null!=e?i(e,"theme"):e,"===","overlay",{name:"ifCond",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:1},end:{line:2,column:59}}}))?o:"")+'">\n\n'+(null!=(o=(i(t,"isFlipped")||e&&i(e,"isFlipped")||u).call(r,"enable-likes",{name:"isFlipped",hash:{},fn:n.program(3,a,0),inverse:n.program(5,a,0),data:a,loc:{start:{line:4,column:1},end:{line:15,column:15}}}))?o:"")+'\t\n\t<span role="button" class="engagement-item comment" tabindex="0">\n\t\t<span class="engagement-icon">\n\t\t\t<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n\t\t</span>\n\t\t<span class="engagement-count'+(null!=(o=i(t,"if").call(r,null!=(o=null!=(o=null!=e?i(e,"photoItem"):e)?i(o,"engagement"):o)?i(o,"commentCount"):o,{name:"if",hash:{},fn:n.noop,inverse:n.program(10,a,0),data:a,loc:{start:{line:21,column:31},end:{line:21,column:85}}}))?o:"")+'">\n\t\t\t'+(null!=(o=i(t,"if").call(r,null!=(o=null!=(o=null!=e?i(e,"photoItem"):e)?i(o,"engagement"):o)?i(o,"commentCount"):o,{name:"if",hash:{},fn:n.program(14,a,0),inverse:n.noop,data:a,loc:{start:{line:22,column:3},end:{line:22,column:101}}}))?o:"")+"\n\t\t</span>\n\t</span>\n"+(null!=(o=i(t,"if").call(r,null!=e?i(e,"displayCurate"):e,{name:"if",hash:{},fn:n.program(16,a,0),inverse:n.noop,data:a,loc:{start:{line:25,column:1},end:{line:31,column:8}}}))?o:"")+(null!=(o=i(t,"if").call(r,null!=e?i(e,"displayShare"):e,{name:"if",hash:{},fn:n.program(18,a,0),inverse:n.noop,data:a,loc:{start:{line:32,column:1},end:{line:34,column:8}}}))?o:"")+"</div>\n"},useData:!0}),l={};n.Array.each([],function(e){var t=n.Template.get("hermes/"+e);t&&(l[e]=t)}),n.Template.register("hermes/photo-card-engagement",function(e,a){return a=a||{},a.partials=a.partials?n.merge(l,a.partials):l,t(e,a)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-card-engagement-view",function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("photo-card-engagement-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.set("isActiveViewAgnostic",!0),this.signedIn=this.appContext.getViewer().signedIn,this.params=t,this.config={displayCurate:!("displayCurate"in t)||t.displayCurate,displayShare:"displayShare"in t&&t.displayShare,photoItem:t.photoItem,theme:t.theme,enableFaveKey:t.enableFaveKey},this.config.displayCurate=this.config.displayCurate&&this.signedIn,t.subviewParams={"like-engagement-item-view":{photoId:t.photoItem.photoId,showCount:!0,size:"small",isPadded:!1,theme:"overlay"===this.config.theme?"light":void 0},"fluid-share-photo-view":{photoId:t.photoItem.photoId,nsid:t.photoItem.owner.nsid,size:"small",theme:"light"}},this.curationHelper=new e.CurationHelper(this.appContext)},subviewConfig:{"like-engagement-item-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["engagement-item","like"],disabled:function(){return!this.appContext.flipper.isFlipped("enable-likes")}},"fluid-share-photo-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["engagement-item","share"]}},buildContainer:function(){this.setContainerWithTemplate("photo-card-engagement",this.config)},activate:function(){var e=this.get("container");this.faveNode=e.one(".engagement-item.fave"),this.commentNode=e.one(".engagement-item.comment"),this.curateNode=e.one(".engagement-item.curate"),this.faveNode&&(this.faveCountNode=this.faveNode.one(".engagement-count"),this.registerEventHandler(this.faveNode.on(["click","key"],this.handleFaveClick.bind(this),"down:13")),this.config.enableFaveKey&&(this.keyEventHandler=this.attachKeyEvent("down:70",this.handleFaveKeyPress.bind(this)))),this.commentNode&&(this.commentIcon=this.commentNode.one(".engagement-icon"),this.commentCountNode=this.commentNode.one(".engagement-count"),this.registerEventHandler(this.commentNode.on(["click","key"],this.handleCommentClick.bind(this),"down:13"))),this.curateNode&&this.registerEventHandler(this.curateNode.on(["click","key"],this.handleCurateClick.bind(this),"down:13"))},handleFaveKeyPress:function(e){70===e.keyCode&&this.handleFaveClick(e)},handleFaveClick:function(t){var n,o=this,a=this.faveNode,s=this.faveCountNode;this.faveNode.hasClass("can-not-fave")||(this.signedIn?this.isFaving||(this.isFaving=!0,this.config.photoItem.engagementModel.toggleFave(),n=this.config.photoItem.engagementModel.getValue("faveCount"),a.toggleClass("faved",this.config.photoItem.engagementModel.getValue("isFaved")),s.toggleClass("empty",0===n),s&&n>0?s.set("text",n):s.set("text",""),this.config.photoItem.engagementModel.remoteUpdate().then(function(){o.isFaving=!1},function(e){3!==e.code&&(o.config.photoItem.engagementModel.toggleFave(),a.toggleClass("faved",o.config.photoItem.engagementModel.getValue("isFaved")),s&&(s.set("text",n),s.toggleClass("empty",0===n))),i.error("Error faving photo",{err:e}),o.isFaving=!1})):this.showSignUpAndFaveModal(this.config.photoItem.photoId,e.config.win.location.href))},handleCommentClick:function(){var t=this,i=new e.Views["photo-comments-view"]({appContext:this.appContext,photoId:this.config.photoItem.photoId,isScrollable:!0,addCommentText:this.intlMessage({intlName:"comments.ADD_PHOTO_COMMENT",mediaType:this.config.photoItem.mediaType})}),n=new e.ModalDroparoundHelper(this.appContext,{configs:{common:{subview:i},droparound:{preferTop:!0,width:400,height:400,anchorElement:this.commentIcon,keyboardAnchorElement:this.commentNode},modal:{height:550,flexLayout:!0}}});n.show(),t.registerEventHandler(e.on("addComment:showingSignupModal",function(){n.close()})),t.registerEventHandler(n.on("close",function(){t.commentNode.removeClass("active"),t.fire("menuClosed")})),this.commentNode.addClass("active"),this.fire("menuOpened")},handleCurateClick:function(){var e=this,t=this.config.photoItem.isOwner;"fluid-droparound-view"===this.curationHelper.showAddToCuration({photoId:this.config.photoItem.photoId,showAlbums:t,showGalleries:!t,anchorNode:this.curateNode}).name&&(this.fire("menuOpened"),this.curationHelper.on("curateDroparoundClosed",function(){e.fire("menuClosed"),e.curateNode.removeClass("active")}),this.curateNode.addClass("active"))},showSignUpAndFaveModal:function(t,i){var n,o=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),a=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"});n=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:o,signUpMessage:a,beaconPrefix:"fave"}),this.registerEventHandler(n.on("signUpClick",function(n){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:i})})),this.registerEventHandler(n.on("signInClick",function(n){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:i})})),n.show()},toggleCommentNode:function(e){this.commentNode&&this.commentNode.toggleClass("hidden",!e)},toggleFaveNode:function(e){this.faveNode&&this.faveNode.toggleClass("hidden",!e)}})},"@VERSION@",{requires:["flickr-view","photo-comments-view","fluid-share-photo-view","hermes-template-photo-card-engagement","curation-helper","modal-droparound-helper"],langBundles:["common","comments","fave-view"]});